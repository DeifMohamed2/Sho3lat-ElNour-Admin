<!DOCTYPE html>
<html lang="ar" dir="rtl">

<%- include("../Admin/partials/head.ejs") %>

<style>
  .spinner {
    width: 56px;
    height: 56px;
    display: grid;
    border: 4.5px solid #0000;
    border-radius: 50%;
    border-color: #dbdcef #0000;
    animation: spinner-e04l1k 1s infinite linear;
  }

  .spinner::before,
  .spinner::after {
    content: "";
    grid-area: 1/1;
    margin: 2.2px;
    border: inherit;
    border-radius: 50%;
  }

  .spinner::before {
    border-color: #474747 #0000;
    animation: inherit;
    animation-duration: 0.5s;
    animation-direction: reverse;
  }

  .spinner::after {
    margin: 8.9px;
  }

  @keyframes spinner-e04l1k {
    100% {
      transform: rotate(1turn);
    }
  }

  .table-responsive {
    max-height: 600px;
    overflow-y: auto;
  }
  
  .table-responsive table thead {
    position: sticky;
    top: 0;
    z-index: 10;
    background: #f8f9fa;
  }

  .class-row:hover {
    background-color: #f8f9fa;
  }

  .capacity-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .capacity-low {
    background-color: #d4edda;
    color: #155724;
  }

  .capacity-medium {
    background-color: #fff3cd;
    color: #856404;
  }

  .capacity-high {
    background-color: #f8d7da;
    color: #721c24;
  }

  /* Modal polish */
  .modal-header {
    border-bottom: 1px solid #e9ecef;
  }

  .modal-content {
    border-radius: 12px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
  }

  .modal-title {
    font-weight: 700;
    color: #1f1f1f;
  }

  .form-label {
    font-weight: 600;
    color: #333;
  }

  .form-control,
  .form-select {
    border: 1.5px solid #d6d6d6;
    border-radius: 10px;
    padding: 10px 12px;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .form-control:focus,
  .form-select:focus {
    border-color: #000;
    box-shadow: 0 0 0 0.15rem rgba(0, 0, 0, 0.08);
  }

  .form-text {
    color: #6c757d;
  }

  .btn-primary {
    background: linear-gradient(120deg, #000 0%, #444 100%);
    border: none;
  }

  .btn-primary:hover {
    background: linear-gradient(120deg, #111 0%, #555 100%);
  }
</style>

<body class="g-sidenav-show rtl bg-gray-100">
  <%- include("../Admin/partials/aside.ejs") %>

  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
    <%- include("../Admin/partials/nav.ejs") %>

    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-12">
          <div class="card my-4">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
              <div class="bg-gradient-dark shadow-dark border-radius-lg pt-4 pb-3">
                <div class="d-flex justify-content-between align-items-center px-3">
                  <h6 class="text-white text-capitalize ps-3">إدارة الفصول الدراسية</h6>
                  <button id="openAddClassBtn" type="button" class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#addClassModal">
                    <i class="material-symbols-rounded">add</i> إضافة فصل جديد
                  </button>
                </div>
              </div>
            </div>

            <div class="card-body px-0 pb-2">
              <!-- Loading Spinner -->
              <div id="loading" class="text-center py-4" style="display: none;">
                <div class="spinner"></div>
              </div>

              <!-- Classes Table -->
              <div class="table-responsive px-3">
                <table class="table table-hover align-items-center mb-0">
                  <thead>
                    <tr>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">اسم الفصل</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">المستوى</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">الشعبة</th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">عدد الطلاب</th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">السعة</th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">الجدول</th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">الحالة</th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">الإجراءات</th>
                    </tr>
                  </thead>
                  <tbody id="classesTableBody">
                    <!-- Classes will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Add Class Modal -->
  <div class="modal fade" id="addClassModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">إضافة فصل جديد</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="addClassForm">
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">اسم الفصل</label>
              <input type="text" class="form-control" name="className" placeholder="مثال: 3 علمي" required>
              <div class="form-text">استخدم اسماً واضحاً يسهل تمييزه.</div>
            </div>
            <div class="mb-3">
              <label class="form-label">المستوى الدراسي</label>
              <select class="form-select" name="academicLevel" required>
                <option value="">اختر المستوى</option>
                <option value="Year 1">السنة الأولى</option>
                <option value="Year 2">السنة الثانية</option>
                <option value="Year 3">السنة الثالثة</option>
                <option value="Year 4">السنة الرابعة</option>
                <option value="Year 5">السنة الخامسة</option>
                <option value="Year 6">السنة السادسة</option>
                <option value="Year 7">السنة السابعة</option>
                <option value="Year 8">السنة الثامنة</option>
                <option value="Year 9">السنة التاسعة</option>
                <option value="Year 10">السنة العاشرة</option>
                <option value="Year 11">السنة الحادية عشر</option>
                <option value="Year 12">السنة الثانية عشر</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">الشعبة</label>
              <input type="text" class="form-control" name="section" value="A" required>
              <div class="form-text">استخدم حرف الشعبة مثل A أو B.</div>
            </div>
            <div class="mb-3">
              <label class="form-label">السعة القصوى</label>
              <input type="number" class="form-control" name="capacity" value="30" min="1" required>
              <div class="form-text">الحد الأقصى للطلاب في هذا الفصل.</div>
            </div>
            <div class="mb-3">
              <label class="form-label">ملاحظات</label>
              <textarea class="form-control" name="notes" rows="2" placeholder="مثال: فصل صباحي أو احتياجات خاصة"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">صورة الجدول</label>
              <input type="file" class="form-control" id="addScheduleImage" name="scheduleImage" accept="image/*">
              <div class="form-text">اختر صورة الجدول الدراسي للفصل (اختياري)</div>
              <div id="addImagePreview" class="mt-2" style="display: none;">
                <img id="addPreviewImg" src="" alt="معاينة" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #ddd;">
                <button type="button" class="btn btn-sm btn-danger mt-2" id="removeAddPreview">
                  <i class="material-symbols-rounded text-sm">delete</i> إزالة الصورة
                </button>
              </div>
              <div id="addUploadProgress" class="progress mt-2" style="display: none; height: 20px;">
                <div id="addProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%">0%</div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
            <button type="submit" class="btn btn-primary">حفظ</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Class Modal -->
  <div class="modal fade" id="editClassModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">تعديل الفصل</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="editClassForm">
          <input type="hidden" id="editClassId">
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">اسم الفصل</label>
              <input type="text" class="form-control" id="editClassName" required>
            </div>
            <div class="mb-3">
              <label class="form-label">المستوى الدراسي</label>
              <select class="form-control" id="editAcademicLevel" required>
                <option value="Year 1">السنة الأولى</option>
                <option value="Year 2">السنة الثانية</option>
                <option value="Year 3">السنة الثالثة</option>
                <option value="Year 4">السنة الرابعة</option>
                <option value="Year 5">السنة الخامسة</option>
                <option value="Year 6">السنة السادسة</option>
                <option value="Year 7">السنة السابعة</option>
                <option value="Year 8">السنة الثامنة</option>
                <option value="Year 9">السنة التاسعة</option>
                <option value="Year 10">السنة العاشرة</option>
                <option value="Year 11">السنة الحادية عشر</option>
                <option value="Year 12">السنة الثانية عشر</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">الشعبة</label>
              <input type="text" class="form-control" id="editSection" required>
            </div>
            <div class="mb-3">
              <label class="form-label">السعة القصوى</label>
              <input type="number" class="form-control" id="editCapacity" required>
            </div>
            <div class="mb-3">
              <label class="form-check">
                <input type="checkbox" class="form-check-input" id="editIsActive">
                <span class="form-check-label">الفصل نشط</span>
              </label>
            </div>
            <div class="mb-3">
              <label class="form-label">ملاحظات</label>
              <textarea class="form-control" id="editNotes" rows="2"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">صورة الجدول</label>
              <input type="file" class="form-control" id="editScheduleImage" name="scheduleImage" accept="image/*">
              <div class="form-text">اختر صورة جديدة لاستبدال الصورة الحالية (اختياري)</div>
              <div id="editCurrentImage" class="mt-2" style="display: none;">
                <p class="text-sm mb-1">الصورة الحالية:</p>
                <img id="editCurrentImg" src="" alt="الصورة الحالية" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #ddd;">
                <button type="button" class="btn btn-sm btn-danger mt-2" id="deleteCurrentImage">
                  <i class="material-symbols-rounded text-sm">delete</i> حذف الصورة الحالية
                </button>
              </div>
              <div id="editImagePreview" class="mt-2" style="display: none;">
                <p class="text-sm mb-1">معاينة الصورة الجديدة:</p>
                <img id="editPreviewImg" src="" alt="معاينة" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #ddd;">
                <button type="button" class="btn btn-sm btn-danger mt-2" id="removeEditPreview">
                  <i class="material-symbols-rounded text-sm">delete</i> إزالة الصورة
                </button>
              </div>
              <div id="editUploadProgress" class="progress mt-2" style="display: none; height: 20px;">
                <div id="editProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%">0%</div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
            <button type="submit" class="btn btn-primary">حفظ التغييرات</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Schedule Image Viewer Modal -->
  <div class="modal fade" id="scheduleImageModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">صورة الجدول</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <img id="scheduleImageViewer" src="" alt="صورة الجدول" style="max-width: 100%; height: auto; border-radius: 8px;">
        </div>
      </div>
    </div>
  </div>

  <script src="/js/adminJS/classes.js"></script>
  <!-- Core JS -->
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
</body>

</html>